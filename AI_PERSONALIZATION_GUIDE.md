# AI 個性化學習與記憶系統指南

## 概述

這個系統讓 AI 能夠主動學習和記憶用戶的使用習慣，並根據用戶的歷史行為自動調整回應方式，提供個性化的學習體驗。

## 核心功能

### 1. 用戶行為追蹤
- **自動記錄**：系統自動追蹤用戶的所有關鍵操作
  - 課程生成（主題、類型、科目）
  - 故事生成（風格、語言、年齡組）
  - 作業輔導使用（科目、級別）
  - 語言切換
  - 功能點擊

### 2. 偏好分析與學習
- **自動偏好提取**：從用戶行為中自動提取偏好
  - 最常使用的科目
  - 最喜歡的課程類型
  - 偏好的故事風格
  - 語言偏好
  - 難度偏好

### 3. 個性化提示詞生成
- **動態調整**：根據用戶偏好動態生成個性化的 AI 提示詞
  - 語調調整（友好、專業、活潑、鼓勵）
  - 互動風格（詳細、平衡、簡潔）
  - 學習節奏（慢、正常、快）
  - 難度級別（簡單、中等、困難）
  - 學習風格（視覺、聽覺、動覺）

### 4. AI 記憶系統
- **上下文記憶**：AI 記住用戶的重要信息
  - 學習偏好
  - 感興趣的主題
  - 學習強項和弱點
  - 過去的互動上下文

### 5. 反饋循環
- **持續改進**：收集用戶反饋以改進 AI 回應
  - 評分系統（1-5 星）
  - 文字反饋
  - 改進建議

## 數據庫結構

### 表說明

1. **user_behavior_logs** - 用戶行為日誌
   - 記錄所有用戶操作
   - 包含動作類型和詳細信息

2. **user_preferences** - 用戶偏好設置
   - 存儲用戶的學習偏好
   - 自動從行為中更新

3. **user_learning_profile** - 用戶學習檔案
   - AI 分析的學習風格
   - 參與模式
   - 興趣主題

4. **ai_response_feedback** - AI 回應反饋
   - 用戶對 AI 回應的評分和反饋

5. **ai_user_memories** - AI 記憶
   - AI 對用戶的重要記憶
   - 上下文信息

## 部署步驟

### 1. 部署數據庫遷移
在 Supabase Dashboard 執行：
```sql
-- 執行文件：supabase/migrations/003_create_user_learning_ai_tables.sql
```

### 2. 部署 Edge Function
部署 `ai-personalization` Edge Function：
```bash
# 通過 Supabase Dashboard 或 CLI
supabase functions deploy ai-personalization
```

### 3. 配置環境變量
確保 Edge Function 有正確的環境變量：
- `SUPABASE_URL`
- `SUPABASE_ANON_KEY`

## 使用方式

### 自動行為追蹤
系統會自動追蹤用戶行為，無需額外配置。

### 獲取個性化提示詞
```javascript
// 在調用 AI 前獲取個性化提示詞
const personalizedPrompt = await getPersonalizedPrompt({
    prompt_type: 'lesson_generation',
    context: { subject: 'English', age: '6-10 years' }
});
```

### 保存用戶反饋
```javascript
// 當用戶對 AI 回應進行評分時
await saveUserFeedback(
    'lesson',           // 回應類型
    lessonId,          // 回應 ID
    5,                 // 評分 (1-5)
    '非常有用！',      // 反饋文字
    true               // 是否有幫助
);
```

### 分析學習風格
```javascript
// 定期分析用戶學習風格（系統自動調用）
await analyzeUserLearningStyle();
```

## AI 如何學習和適應

### 1. 行為模式識別
- 系統分析用戶的使用頻率
- 識別最常使用的功能和主題
- 檢測使用習慣的變化

### 2. 偏好推斷
- 從行為日誌中推斷偏好
- 自動更新偏好設置
- 識別學習風格

### 3. 提示詞優化
- 根據用戶偏好動態調整 AI 提示詞
- 優化回應的語調、風格和內容長度
- 適應用戶的學習節奏

### 4. 記憶管理
- 存儲重要的用戶信息
- 在後續互動中引用記憶
- 根據重要性評分管理記憶

## 個性化示例

### 示例 1：語調適應
- **友好型用戶**：AI 使用溫暖、鼓勵的語調
- **專業型用戶**：AI 使用專業但親切的語調
- **活潑型用戶**：AI 使用有趣、幽默的語調

### 示例 2：內容長度適應
- **簡潔偏好**：AI 提供簡短、重點突出的回應
- **詳細偏好**：AI 提供全面、深入的解釋

### 示例 3：難度適應
- **初學者**：使用簡單語言和基礎概念
- **進階者**：可以使用高級詞彙和複雜概念

## 未來擴展

1. **機器學習模型**：使用 ML 模型預測用戶需求
2. **推薦系統**：基於歷史推薦相關內容
3. **適應性學習路徑**：動態調整學習路徑
4. **情感分析**：分析用戶情感狀態並相應調整
5. **協同過濾**：基於相似用戶的偏好提供建議

## 注意事項

- 所有數據都遵循 RLS（Row Level Security）策略
- 用戶只能訪問自己的數據
- 行為追蹤是匿名的，不包含敏感信息
- 用戶可以隨時查看和管理自己的偏好設置

